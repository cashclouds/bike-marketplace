# üöÄ Vercel Deployment Guide

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Vercel –ø–æ—Å–ª–µ security —É–ª—É—á—à–µ–Ω–∏–π.

## ‚úÖ –ß–¢–û –ë–´–õ–û –ò–ó–ú–ï–ù–ï–ù–û

–ë—ã–ª —Å–æ–∑–¥–∞–Ω –∫–æ–º–º–∏—Ç **711c3e4** —Å —Å–ª–µ–¥—É—é—â–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω cookie-parser –¥–ª—è httpOnly cookies
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ CSRF protection (middleware/csrf.ts)
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ API –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cookies
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è filename –≤ upload endpoint

---

## üîß –®–ê–ì–ò –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ù–ê VERCEL

### 1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –∫–æ–º–º–º–∏—Ç—ã –Ω–∞ GitHub

```bash
cd C:\Projects\bike-marketplace
git log --oneline -3
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–º–º–∏—Ç: üîí Security: Major security improvements and bug fixes
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–ê - –∫–æ–º–º–∏—Ç —É–∂–µ –Ω–∞ GitHub (711c3e4)

---

### 2. –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel

–û—Ç–∫—Ä–æ–π—Ç–µ https://vercel.com/dashboard –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ:

#### –î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ):

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Project Settings** ‚Üí **Environment Variables**
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –µ—Å—Ç—å —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
NEXT_PUBLIC_API_URL=https://your-api-domain.com/api
```

(–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π API –Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ)

#### –î–ª—è –±—ç–∫–µ–Ω–¥–∞ (–µ—Å–ª–∏ –æ–Ω –Ω–∞ Vercel –∏–ª–∏ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–∏—Å–µ):

```
# Database
DB_HOST=your_production_db_host
DB_PORT=5432
DB_NAME=bike_marketplace_prod
DB_USER=postgres
DB_PASSWORD=YOUR_STRONG_PASSWORD

# Server
PORT=5001
NODE_ENV=production
USE_HTTPS=true

# JWT (–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π!)
JWT_SECRET=8375892f2ee3b1bf0e7c07fea3116f683b876542ee05d71cf75880318f685411

# CORS
FRONTEND_URL=https://bike-marketplace-rho.vercel.app

# Cloudinary
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# Stripe
STRIPE_PUBLIC_KEY=pk_live_your_key
STRIPE_SECRET_KEY=sk_live_your_key
STRIPE_WEBHOOK_SECRET=whsec_your_secret
```

---

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Vercel

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ `vercel.json` –∏–ª–∏ –≤ Vercel Dashboard —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "nodeVersion": "18.x"
}
```

---

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π build –Ω–∞ Vercel

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://vercel.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç **bike-marketplace**
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Redeploy** –∏–ª–∏ **Rebuild**

–ò–ª–∏ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å push –Ω–∞ main –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ redeploy:

```bash
git push origin main
```

---

### 5. –î–æ–∂–¥–∏—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è deployment

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ Vercel Dashboard
- –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–µ–ª—ë–Ω–æ–π –≥–∞–ª–æ—á–∫–∏ ‚úÖ

---

### 6. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ deployment, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

#### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
curl https://bike-marketplace-rho.vercel.app/
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å HTTP 200
```

#### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ cookies —Ä–∞–±–æ—Ç–∞—é—Ç
```bash
curl -v https://bike-marketplace-rho.vercel.app/api/users/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"test"}'
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å Set-Cookie headers
```

#### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSRF protection
```bash
curl -X POST https://bike-marketplace-rho.vercel.app/api/listings \
  -H "Content-Type: application/json" \
  -d '{}'
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ 403 (CSRF token missing)
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –î–ª—è API –±—ç–∫–µ–Ω–¥–∞

–ï—Å–ª–∏ –≤–∞—à API —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç –Ω–∞ **–æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ** (–Ω–µ –Ω–∞ Vercel), –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ç–∞–º
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `cookie-parser`: `npm install cookie-parser`
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–∏—Å

### –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Vercel –¥–ª—è backend

–ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è backend –Ω–∞ Vercel:

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Vercel –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø–∞–ø–∫–∏ `backend/`
2. –û–±–Ω–æ–≤–∏—Ç—å `NEXT_PUBLIC_API_URL` –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîí –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|------|-------|-----------|
| **cookies** | localStorage | httpOnly cookies | ‚úÖ –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ |
| **CSRF** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫ |
| **Path Traversal** | ‚ùå –£—è–∑–≤–∏–º–æ | ‚úÖ –ó–∞—â–∏—â–µ–Ω–æ | –í–∞–ª–∏–¥–∞—Ü–∏—è filename |
| **JSON parsing** | –ú–æ–∂–µ—Ç –∫—Ä–∞—Ö–Ω—É—Ç—å—Å—è | ‚úÖ Try-catch | –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ |

---

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–û–°–õ–ï DEPLOYMENT

- [ ] –ö–æ–º–º–∏—Ç 711c3e4 –Ω–∞ GitHub
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ Vercel
- [ ] Build —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω (–∑–µ–ª—ë–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ HTTPS
- [ ] CORS —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] Cookies —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- [ ] CSRF protection —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

---

## üÜò –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### –ü—Ä–æ–±–ª–µ–º–∞: "Cookies not being set"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `NODE_ENV=production`
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `USE_HTTPS=true`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `FRONTEND_URL` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

### –ü—Ä–æ–±–ª–µ–º–∞: "CSRF token missing"

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ GET –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç CSRF (–æ–Ω–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è)
2. –î–ª—è POST/PUT/DELETE –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å CSRF token –∏–∑ cookie

### –ü—Ä–æ–±–ª–µ–º–∞: "CORS error"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `FRONTEND_URL` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –¥–æ–º–µ–Ω–æ–º
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `credentials: true` –≤ CORS –∫–æ–Ω—Ñ–∏–≥–µ

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ Vercel Dashboard
2. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ `PRODUCTION_SECURITY_CHECKLIST.md`
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-11-25
**–í–µ—Ä—Å–∏—è**: 1.0
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ deployment
